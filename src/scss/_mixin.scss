@use 'sass:map';
@use 'sass:math';
@use 'sass:color';
@use './variable' as *;

// =============================================================================
// MIXINS
// =============================================================================

// Media query mixin
@mixin respond-to($breakpoint) {
    @if map.has-key($breakpoints, $breakpoint) {
        $value: map.get($breakpoints, $breakpoint);

        @if $value == 0 {
            @content;
        } @else {
            @media (min-width: $value) {
                @content;
            }
        }
    } @else {
        @warn "Unknown breakpoint: #{$breakpoint}";
    }
}

// Responsive mixin (alias for respond-to)
@mixin responsive($breakpoint) {
    @include respond-to($breakpoint) {
        @content;
    }
}

// Max-width media query
@mixin respond-to-max($breakpoint) {
    @if map.has-key($breakpoints, $breakpoint) {
        $value: map.get($breakpoints, $breakpoint);

        @if $value > 0 {
            @media (max-width: #{$value - 1}px) {
                @content;
            }
        }
    } @else {
        @warn "Unknown breakpoint: #{$breakpoint}";
    }
}

// Container mixin
@mixin container($max-width: null) {
    width: 100%;
    margin-left: auto;
    margin-right: auto;
    padding-left: $container-padding;
    padding-right: $container-padding;

    @if $max-width {
        max-width: $max-width;
    } @else {
        @each $breakpoint, $container-max-width in $container-max-widths {
            @include respond-to($breakpoint) {
                max-width: $container-max-width;
            }
        }
    }
}

// Responsive font size mixin
@mixin responsive-font-size($element) {
    @if map.has-key($responsive-font-sizes, $element) {
        $sizes: map.get($responsive-font-sizes, $element);

        @each $breakpoint, $size in $sizes {
            @if $breakpoint == xs {
                font-size: $size;
            } @else {
                @include respond-to($breakpoint) {
                    font-size: $size;
                }
            }
        }
    }
}

// =============================================================================
// Layout Mixins
// =============================================================================

// Aspect ratio mixin
@mixin aspect-ratio($width, $height) {
    position: relative;

    &::before {
        content: '';
        display: block;
        padding-top: (($height / $width) * 100%);
    }

    > * {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
}

// Truncate text mixin
@mixin truncate($lines: 1) {
    @if $lines == 1 {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    } @else {
        display: -webkit-box;
        -webkit-line-clamp: $lines;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
    }
}

// Hide text mixin
@mixin hide-text {
    overflow: hidden;
    text-indent: 101%;
    white-space: nowrap;
}

// Clearfix mixin
@mixin clearfix {
    &::after {
        content: '';
        display: table;
        clear: both;
    }
}

// =============================================================================
// Utility Mixins
// =============================================================================

// Visually hidden (accessible)
@mixin visually-hidden {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
}

// Focus visible mixin
@mixin focus-visible {
    &:focus-visible {
        @content;
    }
}

// Hover mixin with media query support
@mixin hover {
    @media (hover: hover) and (pointer: fine) {
        &:hover {
            @content;
        }
    }
}

// Cross-browser sticky positioning
@mixin sticky($top: 0) {
    position: sticky;
    top: $top;
}

// Cross-browser user-select
@mixin user-select($value) {
    user-select: $value;
}

// Cross-browser appearance
@mixin appearance($value) {
    appearance: $value;
}

// Touch momentum scroll (iOS)
@mixin touch-scroll {
    -webkit-overflow-scrolling: touch;
}

// Reduced motion mixin
@mixin reduced-motion {
    @media (prefers-reduced-motion: reduce) {
        @content;
    }
}

// High contrast mode mixin
@mixin high-contrast {
    @media (prefers-contrast: high) {
        @content;
    }
}

// Dark mode mixin
@mixin dark-mode {
    @media (prefers-color-scheme: dark) {
        @content;
    }
}

// Print styles mixin
@mixin print {
    @media print {
        @content;
    }
}

// Responsive font size mixin
@mixin responsive-font-size($element) {
    @if map.has-key($responsive-font-sizes, $element) {
        $sizes: map.get($responsive-font-sizes, $element);

        @each $breakpoint, $size in $sizes {
            @if $breakpoint == xs {
                font-size: $size;
            } @else {
                @include respond-to($breakpoint) {
                    font-size: $size;
                }
            }
        }
    }
}

// Vendor prefix mixin for cross-browser compatibility
@mixin prefix($property, $value, $prefixes: $vendor-prefixes-list) {
    @each $prefix in $prefixes {
        #{$prefix}#{$property}: $value;
    }
    #{$property}: $value;
}

// Transform with vendor prefixes
@mixin transform($transforms) {
    @include prefix(transform, $transforms);
}

@mixin transform-origin($origin) {
    @include prefix(transform-origin, $origin);
}

@mixin transition($transitions...) {
    @include prefix(transition, $transitions);
}

@mixin transition-property($properties...) {
    @include prefix(transition-property, $properties);
}

@mixin transition-duration($durations...) {
    @include prefix(transition-duration, $durations);
}

@mixin transition-timing-function($functions...) {
    @include prefix(transition-timing-function, $functions);
}

@mixin transition-delay($delays...) {
    @include prefix(transition-delay, $delays);
}

// Animation with vendor prefixes
@mixin keyframes($name) {
    @-webkit-keyframes #{$name} {
        @content;
    }
    @-moz-keyframes #{$name} {
        @content;
    }
    @-o-keyframes #{$name} {
        @content;
    }
    @keyframes #{$name} {
        @content;
    }
}

@mixin animation($animations...) {
    @include prefix(animation, $animations);
}

// Border radius with vendor prefixes
@mixin border-radius($radius) {
    @include prefix(border-radius, $radius, '-webkit-' '-moz-');
}

@mixin border-top-left-radius($radius) {
    @include prefix(border-top-left-radius, $radius, '-webkit-' '-moz-');
}

@mixin border-top-right-radius($radius) {
    @include prefix(border-top-right-radius, $radius, '-webkit-' '-moz-');
}

@mixin border-bottom-right-radius($radius) {
    @include prefix(border-bottom-right-radius, $radius, '-webkit-' '-moz-');
}

@mixin border-bottom-left-radius($radius) {
    @include prefix(border-bottom-left-radius, $radius, '-webkit-' '-moz-');
}

// Box shadow with vendor prefixes
@mixin box-shadow($shadows...) {
    @include prefix(box-shadow, $shadows, '-webkit-' '-moz-');
}

// Filter with vendor prefixes
@mixin filter($filters...) {
    @include prefix(filter, $filters, '-webkit-');
}

// Backdrop filter with vendor prefixes
@mixin backdrop-filter($filters...) {
    @include prefix(backdrop-filter, $filters, '-webkit-');
}
